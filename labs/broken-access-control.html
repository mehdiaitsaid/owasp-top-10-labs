<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-broken-access-control" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Broken Access Control | OWASP TOP 10 Labs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://mehdiaitsaid.github.io/owasp-top-10-labs/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://mehdiaitsaid.github.io/owasp-top-10-labs/img/logo.png"><meta data-rh="true" property="og:url" content="https://mehdiaitsaid.github.io/owasp-top-10-labs/labs/broken-access-control"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Broken Access Control | OWASP TOP 10 Labs"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/owasp-top-10-labs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mehdiaitsaid.github.io/owasp-top-10-labs/labs/broken-access-control"><link data-rh="true" rel="alternate" href="https://mehdiaitsaid.github.io/owasp-top-10-labs/labs/broken-access-control" hreflang="en"><link data-rh="true" rel="alternate" href="https://mehdiaitsaid.github.io/owasp-top-10-labs/labs/broken-access-control" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Broken Access Control","item":"https://mehdiaitsaid.github.io/owasp-top-10-labs/labs/broken-access-control"}]}</script><link rel="stylesheet" href="/owasp-top-10-labs/assets/css/styles.a48fac3f.css">
<script src="/owasp-top-10-labs/assets/js/runtime~main.e45b7267.js" defer="defer"></script>
<script src="/owasp-top-10-labs/assets/js/main.ffb82710.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/owasp-top-10-labs/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/owasp-top-10-labs/"><div class="navbar__logo"><img src="/owasp-top-10-labs/img/logo.png" alt="OWASP TOP 10 Labs" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/owasp-top-10-labs/img/logo.png" alt="OWASP TOP 10 Labs" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OWASP</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/owasp-top-10-labs/labs/intro">Labs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/mehdiaitsaid/owasp-top-10-labs.git" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/intro"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/setup"><span title="Setup" class="linkLabel_WmDU">Setup</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/owasp-top-10-labs/labs/injection/sql-injection"><span title="Injection" class="categoryLinkLabel_W154">Injection</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/owasp-top-10-labs/labs/broken-access-control"><span title="Broken Access Control" class="linkLabel_WmDU">Broken Access Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/cryptographic-failures"><span title="Cryptographic Failures" class="linkLabel_WmDU">Cryptographic Failures</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/insecure-design"><span title="Insecure Design" class="linkLabel_WmDU">Insecure Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/security-misconfiguration"><span title="Security Misconfiguration" class="linkLabel_WmDU">Security Misconfiguration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/vulnerable-outdated-components"><span title="Vulnerable and Outdated Components" class="linkLabel_WmDU">Vulnerable and Outdated Components</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/identification-authentication-failures"><span title="Identification and Authentication Failures" class="linkLabel_WmDU">Identification and Authentication Failures</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/software-data-integrity-failures"><span title="Software and Data Integrity Failures" class="linkLabel_WmDU">Software and Data Integrity Failures</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/logging-monitoring-failures"><span title="Security Logging and Monitoring Failures" class="linkLabel_WmDU">Security Logging and Monitoring Failures</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/owasp-top-10-labs/labs/ssrf"><span title="Server-Side Request Forgery (SSRF)" class="linkLabel_WmDU">Server-Side Request Forgery (SSRF)</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/owasp-top-10-labs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Broken Access Control</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Broken Access Control</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-broken-access-control">What is Broken Access Control?<a href="#what-is-broken-access-control" class="hash-link" aria-label="Direct link to What is Broken Access Control?" title="Direct link to What is Broken Access Control?" translate="no">​</a></h3>
<p>Broken Access Control occurs when a system fails to correctly enforce who can access or perform which actions on resources. When access control is broken, an actor (authenticated or not) can view, modify, delete, or execute things they are not authorized to.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="root-causes">Root causes<a href="#root-causes" class="hash-link" aria-label="Direct link to Root causes" title="Direct link to Root causes" translate="no">​</a></h3>
<ul>
<li>Missing server-side checks — relying only on client-side UI restrictions.</li>
<li>Inconsistent enforcement — some code paths validate permissions while others do not.</li>
<li>Predictable or exposed object identifiers (sequential IDs, predictable filenames) enabling simple guessing.</li>
<li>Overly broad default permissions or roles that grant more privileges than intended.</li>
<li>Complex or fragmented authorization logic that omits edge cases.</li>
<li>Automatic binding / mass assignment where incoming data is mapped directly to internal fields.</li>
<li>Session/token scoping mistakes — tokens that aren’t limited in scope or lifetime.</li>
<li>Hidden or debug functionality left enabled in production code.</li>
<li>Trusting client-supplied data for authorization decisions.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-attackers-exploit-it">How attackers exploit it<a href="#how-attackers-exploit-it" class="hash-link" aria-label="Direct link to How attackers exploit it" title="Direct link to How attackers exploit it" translate="no">​</a></h3>
<ul>
<li>Parameter tampering — changing an identifier in a request (e.g., document_id=45 → document_id=46) to access another user’s resource.</li>
<li>Direct object reference guessing (IDOR) — sequential or predictable IDs allow enumeration of resources.</li>
<li>Mass assignment — sending extra fields (e.g., is_admin=true) that the server accepts and persists.</li>
<li>Function-level access bypass — invoking privileged actions directly when only the UI prevented access.</li>
<li>Token replay / token reuse — using another user’s session token where tokens are not scoped or revoked.</li>
<li>Chaining operations — combining multiple allowed actions in a sequence to escalate privileges.</li>
<li>Hidden endpoint discovery — calling endpoints or functions that exist but are not properly guarded.</li>
<li>Client-side control manipulation — altering forms or scripts so that the client sends values that the server then trusts.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="typical-impacts">Typical impacts<a href="#typical-impacts" class="hash-link" aria-label="Direct link to Typical impacts" title="Direct link to Typical impacts" translate="no">​</a></h3>
<p>Unauthorized data disclosure (personal records, invoices, documents).
Unauthorized data modification (changing records, prices, or settings).
Privilege escalation (ordinary users gaining administrative capabilities).
Resource deletion or denial-of-service for legitimate users.
Legal, regulatory, and reputational consequences.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-scenarios">Real-world scenarios<a href="#real-world-scenarios" class="hash-link" aria-label="Direct link to Real-world scenarios" title="Direct link to Real-world scenarios" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-direct-object-reference-exposure">1) Direct object reference exposure<a href="#1-direct-object-reference-exposure" class="hash-link" aria-label="Direct link to 1) Direct object reference exposure" title="Direct link to 1) Direct object reference exposure" translate="no">​</a></h4>
<ul>
<li>Setup: Resources are accessed by a simple identifier (e.g., /resource?id=123). The system returns the resource if the identifier exists but does not verify ownership.</li>
<li>Exploit: An actor increments the identifier to 124 and receives another person’s document.</li>
<li>Result: Confidential data is disclosed.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-function-level-access-missing">2) Function-level access missing<a href="#2-function-level-access-missing" class="hash-link" aria-label="Direct link to 2) Function-level access missing" title="Direct link to 2) Function-level access missing" translate="no">​</a></h4>
<ul>
<li>Setup: A privileged action (delete, approve, override) is available in the user interface only for certain roles, but the underlying function does not check roles.</li>
<li>Exploit: Any authenticated user invokes the function directly and performs the privileged action.</li>
<li>Result: Unauthorized modifications or deletions.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-mass-assignment-escalation">3) Mass-assignment escalation<a href="#3-mass-assignment-escalation" class="hash-link" aria-label="Direct link to 3) Mass-assignment escalation" title="Direct link to 3) Mass-assignment escalation" translate="no">​</a></h4>
<ul>
<li>Setup: Incoming data is bound automatically to a model. Critical fields (e.g., role, status, price) are not protected.</li>
<li>Exploit: An actor includes role=admin or price=0 in their submission and the system saves it.</li>
<li>Result: Privilege escalation or financial tampering.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-predictable-file-paths-or-identifiers">4) Predictable file paths or identifiers<a href="#4-predictable-file-paths-or-identifiers" class="hash-link" aria-label="Direct link to 4) Predictable file paths or identifiers" title="Direct link to 4) Predictable file paths or identifiers" translate="no">​</a></h4>
<ul>
<li>Setup: Files or documents are stored using predictable names like documents/user_1_report.pdf. Access checks are absent when fetching the file.</li>
<li>Exploit: Changing the path to documents/user_2_report.pdf downloads someone else’s file.</li>
<li>Result: Exposure of sensitive files.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-token-or-session-misuse">5) Token or session misuse<a href="#5-token-or-session-misuse" class="hash-link" aria-label="Direct link to 5) Token or session misuse" title="Direct link to 5) Token or session misuse" translate="no">​</a></h4>
<ul>
<li>Setup: Session tokens are long-lived and not scoped; there’s no revocation mechanism.</li>
<li>Exploit: A leaked or intercepted token is used to perform actions under another user’s identity.</li>
<li>Result: Account takeover and unauthorized actions.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mitigating-broken-access-control--acls-roles-permissions-policies">Mitigating Broken Access Control — ACLs (Roles, Permissions, Policies)<a href="#mitigating-broken-access-control--acls-roles-permissions-policies" class="hash-link" aria-label="Direct link to Mitigating Broken Access Control — ACLs (Roles, Permissions, Policies)" title="Direct link to Mitigating Broken Access Control — ACLs (Roles, Permissions, Policies)" translate="no">​</a></h2>
<p>This section shows how to mitigate Broken Access Control by implementing a robust Access Control List (ACL) system. It explains the three levels (roles, permissions, policies), data model, enforcement points, examples, and practical advice for secure, testable access control.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1--authentication-vs-authorization-before-acls">1- Authentication vs Authorization (Before ACLs)<a href="#1--authentication-vs-authorization-before-acls" class="hash-link" aria-label="Direct link to 1- Authentication vs Authorization (Before ACLs)" title="Direct link to 1- Authentication vs Authorization (Before ACLs)" translate="no">​</a></h3>
<p>Before implementing Access Control Lists (ACLs), it’s essential to understand the difference between authentication and authorization:</p>
<ul>
<li>Authentication verifies who the user is — usually by checking credentials like email and password.</li>
<li>Authorization defines what the authenticated user is allowed to do — for example, whether a doctor can view a patient’s file or update medical notes.</li>
</ul>
<p>In secure systems, authentication always happens first, followed by authorization checks enforced through roles, permissions, and policies. Together, these form the foundation for preventing Broken Access Control vulnerabilities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2--high-level-principles-always-follow">2- High-level principles (always follow)<a href="#2--high-level-principles-always-follow" class="hash-link" aria-label="Direct link to 2- High-level principles (always follow)" title="Direct link to 2- High-level principles (always follow)" translate="no">​</a></h3>
<ul>
<li>Deny by default. If you can’t prove a user has permission, deny the action.</li>
<li>Server-side enforcement only. Never rely on client-side checks. All checks must run on the server (or service) that controls the resource.</li>
<li>Least privilege. Give users the minimal set of permissions required.</li>
<li>Centralize authorization logic. One consistent place to evaluate permissions reduces bugs.</li>
<li>Separation of duties. Distinguish authentication (who you are) from authorization (what you can do).</li>
<li>Fail-safe / explicit errors. On error, return a safe response (e.g., 403).</li>
<li>Audit / logging. Record access decisions (allow/deny) for analysis and incident response.</li>
<li>Test &amp; review. Automated tests, fuzzing, and manual review for edge cases.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3--acl-concepts-explained-roles-permissions-policies">3 — ACL concepts explained (roles, permissions, policies)<a href="#3--acl-concepts-explained-roles-permissions-policies" class="hash-link" aria-label="Direct link to 3 — ACL concepts explained (roles, permissions, policies)" title="Direct link to 3 — ACL concepts explained (roles, permissions, policies)" translate="no">​</a></h3>
<p><strong>Roles</strong> — named groupings representing job functions or user categories (e.g., admin, editor, viewer). Roles simplify management by bundling permissions.
<strong>Permissions</strong> — fine-grained actions the system understands, usually expressed as resource<!-- -->:action<!-- --> (e.g., document<!-- -->:read<!-- -->, appointment<!-- -->:cancel<!-- -->, billing<!-- -->:update<!-- -->).
<strong>Policies</strong> — rules that evaluate context and attributes beyond static role-permission mappings. Policies can include ownership, time windows, attributes, or resource-specific rules (e.g., “users can edit resources they own”, “clinicians can view tests for their assigned patients”, “only during working hours”).</p>
<p>Together they let you express:</p>
<ul>
<li>Role-based grants (RBAC): role -&gt; permission</li>
<li>Attribute-based constraints (ABAC / policies): permission allowed only if context conditions hold</li>
<li>Per-resource overrides: ACL entries for specific objects (e.g., acl_entries(resource_type, resource_id, subject, permission))</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4--recommended-data-model-sql-ish">4 — Recommended data model (SQL-ish)<a href="#4--recommended-data-model-sql-ish" class="hash-link" aria-label="Direct link to 4 — Recommended data model (SQL-ish)" title="Direct link to 4 — Recommended data model (SQL-ish)" translate="no">​</a></h3>
<p>A minimal but practical schema that supports roles, permissions, role assignments, direct permission grants, and resource-level ACLs:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Roles and permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> roles </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> permissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">-- e.g., &quot;appointments:create&quot;, &quot;patients:view&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> role_permissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  permission_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REFERENCES</span><span class="token plain"> roles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CASCADE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REFERENCES</span><span class="token plain"> permissions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CASCADE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- User-role assignments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> user_roles </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> role_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REFERENCES</span><span class="token plain"> roles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Optional: direct user permissions (overrides/exception)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> user_permissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  permission_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowed </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 1 = allow, 0 = deny</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REFERENCES</span><span class="token plain"> permissions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Resource-level ACL (object-level)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> resource_acl </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_type </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">-- e.g., &quot;appointment&quot;, &quot;file&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_id </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">-- object identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subject_type </span><span class="token keyword" style="color:#00009f">ENUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;role&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subject_id </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">-- user_id or role_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  permission_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowed </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REFERENCES</span><span class="token plain"> permissions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Notes:</strong></p>
<p>resource_id is a string so it handles UUIDs or composite keys.
Using both user_permissions and resource_acl allows exceptions and per-resource overrides.
The permissions table centralizes naming so code can check by name or ID.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5--permission-naming-conventions">5 — Permission naming conventions<a href="#5--permission-naming-conventions" class="hash-link" aria-label="Direct link to 5 — Permission naming conventions" title="Direct link to 5 — Permission naming conventions" translate="no">​</a></h3>
<p>Use hierarchical, descriptive permission names:</p>
<ul>
<li>resource<!-- -->:action<!-- --> [<!-- -->:scope<!-- -->]</li>
<li>Examples: appointments<!-- -->:create<!-- -->, appointments<!-- -->:read<!-- -->, appointments<!-- -->:update<!-- -->, files<!-- -->:download<!-- -->, billing<!-- -->:adjust<!-- -->.
This helps map permissions to UI actions and audit logs.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6--authorization-evaluation-flow-recommended">6 — Authorization evaluation flow (recommended)<a href="#6--authorization-evaluation-flow-recommended" class="hash-link" aria-label="Direct link to 6 — Authorization evaluation flow (recommended)" title="Direct link to 6 — Authorization evaluation flow (recommended)" translate="no">​</a></h3>
<p>Design a single function (middleware/service) that answers a single question: “Is subject S allowed to perform ACTION A on RESOURCE R given CONTEXT C?”
Example algorithm:</p>
<ol>
<li>Authenticate user → obtain user_id, roles[], session.</li>
<li>Fetch static grants:<!-- -->
<ul>
<li>Union permissions from roles -&gt; role_permissions.</li>
<li>Add any user_permissions direct grants (explicit deny should override allow).</li>
</ul>
</li>
<li>Check explicit resource-level ACLs in resource_acl for the specific resource_type + resource_id. If an explicit deny exists, return deny. If an explicit allow exists, tentatively allow but still run policies.</li>
<li>Check policy rules (ABAC):<!-- -->
<ul>
<li>Example checks: owner == user_id, user.department == resource.department, time_of_day allowed, appointment.clinician_id == user_id.</li>
<li>Policies can be code functions or declarative rules stored in DB (careful with complexity).</li>
</ul>
</li>
<li>Combine results:<!-- -->
<ul>
<li>Explicit deny anywhere → deny.</li>
<li>Explicit allow from ACL or role + policy satisfied → allow.</li>
<li>Nothing matched → deny (deny-by-default).</li>
</ul>
</li>
<li>Return true/false, and record decision (optionally).</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-enforcement-middleware-php-pseudocode">Example enforcement middleware (PHP pseudocode)<a href="#example-enforcement-middleware-php-pseudocode" class="hash-link" aria-label="Direct link to Example enforcement middleware (PHP pseudocode)" title="Direct link to Example enforcement middleware (PHP pseudocode)" translate="no">​</a></h4>
<p>Place this logic in a single, reusable function and call it at every protected endpoint or service boundary.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function authorize($pdo, $userId, $permissionName, $resourceType = null, $resourceId = null, $context = []) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1) Load permission id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $perm = $pdo-&gt;prepare(&quot;SELECT id FROM permissions WHERE name = ?&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $perm-&gt;execute([$permissionName]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $permRow = $perm-&gt;fetch();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!$permRow) return false; // unknown permission -&gt; deny</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $permId = $permRow[&#x27;id&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2) Check explicit resource ACL (highest priority for object-level control)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($resourceType &amp;&amp; $resourceId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $acl = $pdo-&gt;prepare(&quot;SELECT allowed, subject_type, subject_id FROM resource_acl WHERE resource_type=? AND resource_id=? AND permission_id=? LIMIT 1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $acl-&gt;execute([$resourceType, $resourceId, $permId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $aclRow = $acl-&gt;fetch();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($aclRow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // if subject applies to user or user&#x27;s role (resolve role check outside)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($aclRow[&#x27;subject_type&#x27;] === &#x27;user&#x27; &amp;&amp; intval($aclRow[&#x27;subject_id&#x27;]) === intval($userId)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (bool)$aclRow[&#x27;allowed&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // role subject handling could be added here (check user&#x27;s roles)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3) User-specific permission overrides</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $up = $pdo-&gt;prepare(&quot;SELECT allowed FROM user_permissions WHERE user_id=? AND permission_id=?&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $up-&gt;execute([$userId, $permId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($upRow = $up-&gt;fetch()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (bool)$upRow[&#x27;allowed&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4) Role-based permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $r = $pdo-&gt;prepare(&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SELECT 1 FROM role_permissions rp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JOIN user_roles ur ON ur.role_id = rp.role_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WHERE ur.user_id = ? AND rp.permission_id = ? LIMIT 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $r-&gt;execute([$userId, $permId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!$r-&gt;fetch()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // user has no role grant -&gt; deny by default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 5) Policy checks (example: ownership)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // This is application-specific. Example: if permissionName ends with &#x27;:edit&#x27; and resource has owner_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($resourceType &amp;&amp; $resourceId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // example policy: allow if owner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $ownerStmt = $pdo-&gt;prepare(&quot;SELECT owner_id FROM &quot; . $resourceType . &quot; WHERE id = ? LIMIT 1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $ownerStmt-&gt;execute([$resourceId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($row = $ownerStmt-&gt;fetch()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($row[&#x27;owner_id&#x27;] == $userId) return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 6) No explicit deny and role has permission -&gt; allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Notes:</strong></p>
<ul>
<li>This is simplified; real implementation should handle role subjects in resource_acl, policy engine, caching, and performance.</li>
<li>Policies often require fetching resource metadata (e.g., owner_id) — do it efficiently or cache.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-creating-roles-and-permissions-sql-seed">Example: creating roles and permissions (SQL seed)<a href="#example-creating-roles-and-permissions-sql-seed" class="hash-link" aria-label="Direct link to Example: creating roles and permissions (SQL seed)" title="Direct link to Example: creating roles and permissions (SQL seed)" translate="no">​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> permissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;appointments:create&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;appointments:read&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;appointments:update&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;appointments:delete&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;files:download&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- roles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> roles </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;clinician&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;receptionist&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- grant clinician read/update appointments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> role_permissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> roles r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> permissions p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;clinician&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;appointments:read&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;appointments:update&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- admin gets everything (example)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> role_permissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> permission_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> roles r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> permissions p </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab">Lab<a href="#lab" class="hash-link" aria-label="Direct link to Lab" title="Direct link to Lab" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-1">Introduction<a href="#introduction-1" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h3>
<p>In this lab, we will implement a secure RESTful API for a hospital management system. The goal is to design and develop backend services that handle sensitive healthcare operations—such as user authentication, appointment scheduling, and patient–clinician interactions—while applying best security practices to protect data integrity, confidentiality, and access control.</p>
<p>A REST API (Representational State Transfer Application Programming Interface) is an architectural style that allows different systems to communicate over the web using standard HTTP methods. REST APIs are widely used because they are stateless, scalable, and easy to integrate with both web and mobile applications.</p>
<p>The table below summarizes the most common HTTP methods (verbs) used in REST APIs and their purposes:</p>
<table><thead><tr><th><strong>HTTP Method</strong></th><th><strong>Description</strong></th><th><strong>Typical Use Case</strong></th></tr></thead><tbody><tr><td><strong>GET</strong></td><td>Retrieve data from the server.</td><td>Get a list of appointments or details of a specific patient.</td></tr><tr><td><strong>POST</strong></td><td>Send new data to the server.</td><td>Create a new user or schedule a new appointment.</td></tr><tr><td><strong>PUT</strong></td><td>Update existing data on the server.</td><td>Modify a patient’s information or update appointment details.</td></tr><tr><td><strong>DELETE</strong></td><td>Remove data from the server.</td><td>Delete an appointment or remove a user record.</td></tr><tr><td><strong>PATCH</strong></td><td>Partially update existing data.</td><td>Change only the appointment status (e.g., from “Pending” to “Confirmed”).</td></tr></tbody></table>
<p>In the following sections, we will begin implementing these operations step by step to build a complete and secure REST API for the hospital system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab-objective">Lab Objective<a href="#lab-objective" class="hash-link" aria-label="Direct link to Lab Objective" title="Direct link to Lab Objective" translate="no">​</a></h3>
<p>The objective of this lab is to identify and fix Broken Access Control vulnerabilities in a hospital REST API.
You will learn how to:</p>
<ul>
<li>Implement role-based restrictions to prevent unauthorized actions.</li>
<li>Secure endpoints so that only allowed users can access or modify specific data.</li>
<li>Apply least privilege principles for all API operations.</li>
<li>Test and verify access control rules to ensure data isolation between users.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup" translate="no">​</a></h3>
<p>In this lab, we will continue using the same hospital database created in the <a href="/owasp-top-10-labs/labs/setup">setup section</a>.
All authentication, authorization, and access control mechanisms will be built on top of this existing data model, which already includes users, roles, patients, appointments, and related entities.</p>
<p>We will start by implementing user authentication through a secure login API, then progressively add authorization rules to protect sensitive endpoints such as patient records, medical notes, and billing information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1--implementing-the-appointments-rest-api">Phase 1 — Implementing the Appointments REST API<a href="#phase-1--implementing-the-appointments-rest-api" class="hash-link" aria-label="Direct link to Phase 1 — Implementing the Appointments REST API" title="Direct link to Phase 1 — Implementing the Appointments REST API" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-1--setting-up-the-endpoint-structure">Step 1 — Setting Up the Endpoint Structure<a href="#step-1--setting-up-the-endpoint-structure" class="hash-link" aria-label="Direct link to Step 1 — Setting Up the Endpoint Structure" title="Direct link to Step 1 — Setting Up the Endpoint Structure" translate="no">​</a></h4>
<p>Create a new file called appointments.php inside your API folder.
This file will handle all CRUD (Create, Read, Update, Delete) operations related to appointments.
We’ll use the same db.php and utils.php files for database connection and JSON responses.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2--handle-http-methods">Step 2 — Handle HTTP Methods<a href="#step-2--handle-http-methods" class="hash-link" aria-label="Direct link to Step 2 — Handle HTTP Methods" title="Direct link to Step 2 — Handle HTTP Methods" translate="no">​</a></h4>
<p>Inside appointments.php, start by detecting the HTTP request method using $_SERVER[&#x27;REQUEST_METHOD&#x27;].
Depending on the method, call the appropriate function:</p>
<ul>
<li>GET → Retrieve appointments</li>
<li>POST → Create a new appointment</li>
<li>PUT → Update an existing appointment</li>
<li>DELETE → Remove an appointment</li>
</ul>
<blockquote>
<p>Note: You can test the API using any HTTP client (e.g., curl, Insomnia, or browser plugins).
In this lab, we will use Postman to send requests and verify the behavior of each endpoint.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3--fetch-appointments-get">Step 3 — Fetch Appointments (GET)<a href="#step-3--fetch-appointments-get" class="hash-link" aria-label="Direct link to Step 3 — Fetch Appointments (GET)" title="Direct link to Step 3 — Fetch Appointments (GET)" translate="no">​</a></h4>
<p>Write a SQL query to retrieve appointments along with their related patient and clinician details.
Use a JOIN between the appointments, patients, and users tables.
Return the result as JSON using your helper function.</p>
<p><strong>Example idea:</strong></p>
<ul>
<li>/api/appointments → returns all appointments</li>
<li>/api/appointments?id=3 → returns details for appointment with ID 3</li>
</ul>
<p>Code sample:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        if (isset($_GET[&#x27;id&#x27;])) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $stmt = $pdo-&gt;prepare(&quot;SELECT * FROM appointments WHERE id = ?&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $stmt-&gt;execute([$_GET[&#x27;id&#x27;]]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $appointment = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!$appointment) sendJson([&quot;error&quot; =&gt; &quot;Appointment not found&quot;], 404);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sendJson($appointment);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $stmt = $pdo-&gt;query(&quot;SELECT * FROM appointments&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sendJson($stmt-&gt;fetchAll(PDO::FETCH_ASSOC));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre></div></div>
<p>Result for All :</p>
<p><img decoding="async" loading="lazy" alt="img_1.png" src="/owasp-top-10-labs/assets/images/img_1-86eb51fe3b143d762856185dc6718746.png" width="1986" height="1501" class="img_ev3q"></p>
<p>Result for One :</p>
<p><img decoding="async" loading="lazy" alt="img_2.png" src="/owasp-top-10-labs/assets/images/img_2-2accc5822ed38f5f1c1bacf9baf0fb79.png" width="1986" height="1288" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-4--create-a-new-appointment-post">Step 4 — Create a New Appointment (POST)<a href="#step-4--create-a-new-appointment-post" class="hash-link" aria-label="Direct link to Step 4 — Create a New Appointment (POST)" title="Direct link to Step 4 — Create a New Appointment (POST)" translate="no">​</a></h4>
<p>Read JSON input from php://input containing the appointment details such as:</p>
<ul>
<li>patient_id</li>
<li>clinician_id</li>
<li>scheduled_at</li>
<li>reason</li>
</ul>
<p>Then insert a new row into the appointments table.
Return a success message and the new appointment ID in JSON.</p>
<p>Code sample:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        $input = json_decode(file_get_contents(&#x27;php://input&#x27;), true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!$input || !isset($input[&#x27;patient_id&#x27;], $input[&#x27;clinician_id&#x27;], $input[&#x27;date_time&#x27;], $input[&#x27;reason&#x27;])) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sendJson([&quot;error&quot; =&gt; &quot;Missing required fields&quot;], 400);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $stmt = $pdo-&gt;prepare(&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            INSERT INTO appointments (patient_id, clinician_id, date_time, reason, status)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            VALUES (?, ?, ?, ?, ?)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $stmt-&gt;execute([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;patient_id&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;clinician_id&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;date_time&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;reason&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;status&#x27;] ?? &#x27;Scheduled&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendJson([&quot;message&quot; =&gt; &quot;Appointment created successfully&quot;, &quot;id&quot; =&gt; $pdo-&gt;lastInsertId()], 201);</span><br></span></code></pre></div></div>
<p>Result :
<img decoding="async" loading="lazy" alt="img_3.png" src="/owasp-top-10-labs/assets/images/img_3-cbfc23d9d7ba48ff2a0ef8a2d2ee7cd4.png" width="1984" height="1095" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-5--update-an-appointment-put">Step 5 — Update an Appointment (PUT)<a href="#step-5--update-an-appointment-put" class="hash-link" aria-label="Direct link to Step 5 — Update an Appointment (PUT)" title="Direct link to Step 5 — Update an Appointment (PUT)" translate="no">​</a></h4>
<p>Read the appointment id and updated fields (like status or reason) from the JSON request.
Execute an UPDATE query to modify the existing record.
Respond with confirmation that the appointment was updated.</p>
<p>Code sample:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        if (!isset($_GET[&#x27;id&#x27;])) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sendJson([&quot;error&quot; =&gt; &quot;Missing appointment ID&quot;], 400);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $id = $_GET[&#x27;id&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $input = json_decode(file_get_contents(&#x27;php://input&#x27;), true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $stmt = $pdo-&gt;prepare(&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UPDATE appointments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SET patient_id = ?, clinician_id = ?, date_time = ?, reason = ?, status = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            WHERE id = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $stmt-&gt;execute([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;patient_id&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;clinician_id&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;date_time&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;reason&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $input[&#x27;status&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendJson([&quot;message&quot; =&gt; &quot;Appointment updated successfully&quot;]);</span><br></span></code></pre></div></div>
<p>Result :
<img decoding="async" loading="lazy" alt="img_4.png" src="/owasp-top-10-labs/assets/images/img_4-e59d8f59dbc79530fb0beabc202ddcc2.png" width="1986" height="1047" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-6--delete-an-appointment-delete">Step 6 — Delete an Appointment (DELETE)<a href="#step-6--delete-an-appointment-delete" class="hash-link" aria-label="Direct link to Step 6 — Delete an Appointment (DELETE)" title="Direct link to Step 6 — Delete an Appointment (DELETE)" translate="no">​</a></h4>
<p>Read the id parameter (e.g., /api/appointments?id=5)
Execute a DELETE query to remove that appointment.
Return a JSON message confirming deletion.</p>
<p>Code sample:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (!isset($_GET[&#x27;id&#x27;])) sendJson([&quot;error&quot; =&gt; &quot;Missing appointment ID&quot;], 400);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $stmt = $pdo-&gt;prepare(&quot;DELETE FROM appointments WHERE id = ?&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $stmt-&gt;execute([$_GET[&#x27;id&#x27;]]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendJson([&quot;message&quot; =&gt; &quot;Appointment deleted successfully&quot;]);</span><br></span></code></pre></div></div>
<p>Result:
<img decoding="async" loading="lazy" alt="img.png" src="/owasp-top-10-labs/assets/images/img-2dc9979e412b3ea5dccb279aa8242100.png" width="1986" height="1048" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-7--test-the-api">Step 7 — Test the API<a href="#step-7--test-the-api" class="hash-link" aria-label="Direct link to Step 7 — Test the API" title="Direct link to Step 7 — Test the API" translate="no">​</a></h4>
<p>Use Postman or curl to test each operation:</p>
<ul>
<li>GET /api/appointments</li>
<li>POST /api/appointments</li>
<li>PUT /api/appointments</li>
<li>DELETE /api/appointments</li>
</ul>
<p>Make sure all CRUD operations work correctly before moving on to adding security controls in the next step.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2--implementing-user-authentication-and-the-me-endpoint">Phase 2 — Implementing User Authentication and the /me Endpoint<a href="#phase-2--implementing-user-authentication-and-the-me-endpoint" class="hash-link" aria-label="Direct link to Phase 2 — Implementing User Authentication and the /me Endpoint" title="Direct link to Phase 2 — Implementing User Authentication and the /me Endpoint" translate="no">​</a></h3>
<p>In this phase, we will implement a login API that allows users to authenticate using their email and password and receive an access token. We will also create a /me endpoint that returns information about the currently authenticated user.</p>
<p>This step lays the foundation for secure access control in the REST API by verifying users before allowing any sensitive operations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1--login-api">Step 1 — Login API<a href="#step-1--login-api" class="hash-link" aria-label="Direct link to Step 1 — Login API" title="Direct link to Step 1 — Login API" translate="no">​</a></h3>
<ol>
<li>Create a file called login.php.</li>
<li>Accept POST requests with Basic Authentication headers (email<!-- -->:password<!-- -->).</li>
<li>Validate the user’s credentials against the users table using password_verify().</li>
<li>If credentials are correct, generate a session token and store it in the sessions table with:</li>
</ol>
<ul>
<li>user_id</li>
<li>session_token</li>
<li>ip_address</li>
<li>user_agent</li>
<li>expires_at (e.g., 1 day from creation)</li>
</ul>
<ol start="5">
<li>Return a JSON response containing:</li>
</ol>
<ul>
<li>token — the access token</li>
<li>user — basic user information (id, name, email, role_id)</li>
</ul>
<p><img decoding="async" loading="lazy" alt="img_5.png" src="/owasp-top-10-labs/assets/images/img_5-d70e6a46159c57830aa80ac2dab90401.png" width="1983" height="1320" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2--me-endpoint">Step 2 — /me Endpoint<a href="#step-2--me-endpoint" class="hash-link" aria-label="Direct link to Step 2 — /me Endpoint" title="Direct link to Step 2 — /me Endpoint" translate="no">​</a></h4>
<ol>
<li>Create a file called me.php.</li>
<li>Accept GET requests.</li>
<li>Read the access token from the Authorization: Bearer &lt;token&gt; header.</li>
<li>Verify the token exists in the sessions table and has not expired or been revoked.</li>
<li>Return the authenticated user’s information in JSON:</li>
</ol>
<ul>
<li>id</li>
<li>name</li>
<li>email</li>
<li>role_id</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3--testing">Step 3 — Testing<a href="#step-3--testing" class="hash-link" aria-label="Direct link to Step 3 — Testing" title="Direct link to Step 3 — Testing" translate="no">​</a></h4>
<p>Use Postman to:</p>
<ol>
<li>Send a POST request to /login.php with email/password.</li>
<li>Receive the access token in the response.</li>
<li>Use the token in the Authorization header for /me:</li>
</ol>
<blockquote>
<p>Authorization: Bearer &lt;token&gt;</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="img_6.png" src="/owasp-top-10-labs/assets/images/img_6-665becb1bdfcc00d96776f9f8e01bff7.png" width="1989" height="636" class="img_ev3q"></p>
<ol start="5">
<li>Verify the response returns the correct user information.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="img_7.png" src="/owasp-top-10-labs/assets/images/img_7-33e7e46e3f028b77c72bc9a526d9e6b7.png" width="1981" height="1152" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3--adding-authentication-to-appointments-api">Phase 3 — Adding Authentication to Appointments API<a href="#phase-3--adding-authentication-to-appointments-api" class="hash-link" aria-label="Direct link to Phase 3 — Adding Authentication to Appointments API" title="Direct link to Phase 3 — Adding Authentication to Appointments API" translate="no">​</a></h3>
<p>In this phase, you will update the appointments REST API so that only logged-in users can access it. This ensures that all endpoints are protected by authentication, laying the foundation for secure access control.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps:<a href="#steps" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:" translate="no">​</a></h4>
<ol>
<li>Require authentication for all endpoints</li>
</ol>
<ul>
<li>
<p>At the top of appointments.php, read the token from the Authorization header:</p>
<blockquote>
<p>Authorization: Bearer &lt;token&gt;</p>
</blockquote>
</li>
<li>
<p>Verify the token in the sessions table:</p>
<ul>
<li>Must exist</li>
<li>Must not be expired</li>
<li>Must not be revoked</li>
</ul>
</li>
</ul>
<ol start="2">
<li>Block unauthenticated requests</li>
</ol>
<ul>
<li>If the token is missing or invalid, return a 401 Unauthorized response in JSON.</li>
</ul>
<ol start="3">
<li>Use authenticated user info</li>
</ol>
<ul>
<li>Store the authenticated user details in a variable (e.g., $currentUser) to use later in your endpoints if needed.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing:<a href="#testing" class="hash-link" aria-label="Direct link to Testing:" title="Direct link to Testing:" translate="no">​</a></h4>
<p>Use Postman:</p>
<ol>
<li>
<p>Log in via /login.php to get a token.</p>
</li>
<li>
<p>Send requests to /appointments.php with the header:</p>
<blockquote>
<p>Authorization: Bearer &lt;token&gt;</p>
</blockquote>
</li>
<li>
<p>Requests without a token should fail with 401 Unauthorized.</p>
</li>
<li>
<p>Requests with a valid token should succeed.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4--role-based-access-control-admin-only-for-appointments-api">Phase 4 — Role-Based Access Control (Admin Only) for Appointments API<a href="#phase-4--role-based-access-control-admin-only-for-appointments-api" class="hash-link" aria-label="Direct link to Phase 4 — Role-Based Access Control (Admin Only) for Appointments API" title="Direct link to Phase 4 — Role-Based Access Control (Admin Only) for Appointments API" translate="no">​</a></h3>
<p>In this phase, you will enforce role-based access control (RBAC) on the appointments REST API. Only users with the admin role will be allowed to access certain endpoints (e.g., create, update, delete appointments), while other logged-in users can only view data if allowed.</p>
<p>This demonstrates how to combine authentication (Phase 3) with authorization to implement secure, controlled access.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps-1">Steps:<a href="#steps-1" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:" translate="no">​</a></h4>
<ol>
<li>Determine the user’s role</li>
</ol>
<ul>
<li>After authenticating the user using the Bearer token, fetch the user’s role_id and optionally the role name from the roles table.</li>
<li>Store this info in a variable, e.g., $currentUserRole.</li>
</ul>
<ol start="2">
<li>Restrict access based on role</li>
</ol>
<ul>
<li>For endpoints like POST, PUT, DELETE in appointments.php, check if the user has the admin role:</li>
</ul>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ($currentUserRole !== &#x27;admin&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendJson([&#x27;error&#x27; =&gt; &#x27;Forbidden: Admins only&#x27;], 403);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ul>
<li>Only allow users with the admin role to perform changes.</li>
<li>GET requests may still be allowed for all authenticated users, depending on your design.</li>
</ul>
<ol start="3">
<li>Return proper HTTP codes</li>
</ol>
<ul>
<li>403 Forbidden → user is authenticated but does not have the required role.</li>
<li>401 Unauthorized → user is not logged in (handled in Phase 3).</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-1">Testing:<a href="#testing-1" class="hash-link" aria-label="Direct link to Testing:" title="Direct link to Testing:" translate="no">​</a></h4>
<p>Use Postman:</p>
<ol>
<li>Log in as an admin user → get a token.</li>
<li>Log in as a non-admin user → get a token.</li>
<li>Test the endpoints:</li>
</ol>
<ul>
<li>Admin token → should succeed for create/update/delete.</li>
<li>Non-admin token → should return 403 Forbidden.</li>
</ul>
<p><strong>Note:</strong></p>
<ul>
<li>This phase focuses on authorization by role.</li>
<li>Combined with Phase 3 authentication, this ensures that only valid, properly authorized users can modify critical resources.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-5--permission-based-access-control-per-endpoint">Phase 5 — Permission-Based Access Control per Endpoint<a href="#phase-5--permission-based-access-control-per-endpoint" class="hash-link" aria-label="Direct link to Phase 5 — Permission-Based Access Control per Endpoint" title="Direct link to Phase 5 — Permission-Based Access Control per Endpoint" translate="no">​</a></h3>
<p>What if we want to allow a user to view all appointments but not to create, update, or delete them?
Role-based access alone (like “admin” vs. “user”) may not be enough — we might need fine-grained permissions that control access per endpoint or action.</p>
<p>This phase introduces Permission-Based Access Control (PBAC) — where each API endpoint is associated with a specific permission.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="objective">Objective:<a href="#objective" class="hash-link" aria-label="Direct link to Objective:" title="Direct link to Objective:" translate="no">​</a></h4>
<p>Enhance the access control system to:</p>
<ul>
<li>Define explicit permissions (e.g., view_appointments, create_appointments, update_appointments, delete_appointments).</li>
<li>Assign permissions to roles (e.g., admin, doctor, user).</li>
<li>Enforce these permissions at the API level for every request.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps-2">Steps:<a href="#steps-2" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:" translate="no">​</a></h4>
<ol>
<li>
<p>Determine the user’s role</p>
<ul>
<li>After authenticating the user using the Bearer token, fetch the user’s role_id and optionally the role name from the roles table.</li>
<li>Store this info in a variable, e.g., $currentUserRole.</li>
</ul>
</li>
<li>
<p>Restrict access based on role</p>
<ul>
<li>For endpoints like POST, PUT, DELETE in appointments.php, check if the user has the admin role:</li>
</ul>
</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ($currentUserRole !== &#x27;admin&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendJson([&#x27;error&#x27; =&gt; &#x27;Forbidden: Admins only&#x27;], 403);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ul>
<li>Only allow users with the admin role to perform changes.</li>
<li>GET requests may still be allowed for all authenticated users, depending on your design.</li>
</ul>
<ol start="3">
<li>
<p>Return proper HTTP codes</p>
<ul>
<li>403 Forbidden → user is authenticated but does not have the required role.</li>
<li>401 Unauthorized → user is not logged in (handled in Phase 3).</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-2">Testing:<a href="#testing-2" class="hash-link" aria-label="Direct link to Testing:" title="Direct link to Testing:" translate="no">​</a></h4>
<p>Use Postman:</p>
<ol>
<li>
<p>Log in as an admin user → get a token.</p>
</li>
<li>
<p>Log in as a non-admin user → get a token.</p>
</li>
<li>
<p>Test the endpoints:</p>
<ul>
<li>Admin token → should succeed for create/update/delete.</li>
<li>Non-admin token → should return 403 Forbidden.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-5--policy-based-access-control-pbac">Phase 5 — Policy-Based Access Control (PBAC)<a href="#phase-5--policy-based-access-control-pbac" class="hash-link" aria-label="Direct link to Phase 5 — Policy-Based Access Control (PBAC)" title="Direct link to Phase 5 — Policy-Based Access Control (PBAC)" translate="no">​</a></h3>
<p>In this phase, you will implement policy-based access control to refine authorization beyond simple roles.
While roles define who you are (e.g., admin, clinician), policies define what you can do under certain conditions.</p>
<p>This ensures fine-grained control, such as allowing clinicians to access only their own appointments, while admins can access all appointments.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="concept-overview">Concept Overview<a href="#concept-overview" class="hash-link" aria-label="Direct link to Concept Overview" title="Direct link to Concept Overview" translate="no">​</a></h4>
<table><thead><tr><th><strong>Access Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>Role/Permission-Based</strong></td><td>Access based on role or permission(e.g., only admins can manage data).</td></tr><tr><td><strong>Policy-Based</strong></td><td>Access depends on specific conditions (e.g., clinicians can only modify their own records).</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scenario-in-this-lab">Scenario in This Lab<a href="#scenario-in-this-lab" class="hash-link" aria-label="Direct link to Scenario in This Lab" title="Direct link to Scenario in This Lab" translate="no">​</a></h4>
<p>You will implement two policy rules for the appointments API:</p>
<table><thead><tr><th><strong>Action</strong></th><th><strong>Policy Rule</strong></th></tr></thead><tbody><tr><td><strong>GET /appointments</strong></td><td>- <strong>Admins:</strong> Can retrieve all appointments. - <strong>Clinicians:</strong> Can retrieve only their own appointments (`WHERE clinician_id = user_id`).</td></tr><tr><td><strong>PUT /appointments/{id}</strong></td><td>- <strong>Admins:</strong> Can update any appointment. - <strong>Clinicians:</strong> Can update only appointments assigned to them.</td></tr><tr><td><strong>DELETE /appointments/{id}</strong></td><td>- <strong>Admins only.</strong></td></tr><tr><td><strong>POST /appointments</strong></td><td>- <strong>Admins only (optional).</strong></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps-3">Steps<a href="#steps-3" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps" translate="no">​</a></h4>
<ol>
<li>
<p>Retrieve the authenticated user</p>
<ul>
<li>From the session token, extract:<!-- -->
<ul>
<li>user_id</li>
<li>role (e.g., admin, clinician)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Implement policy logic</p>
<ul>
<li>In each operation (GET, PUT, DELETE), apply conditional logic:</li>
</ul>
</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if ($currentUserRole === &#x27;admin&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // No restriction — full access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} elseif ($currentUserRole === &#x27;clinician&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Restrict to only their own appointments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query = &quot;SELECT * FROM appointments WHERE clinician_id = :id&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendJson([&#x27;error&#x27; =&gt; &#x27;Forbidden&#x27;], 403);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ol start="3">
<li>Update queries and checks</li>
</ol>
<ul>
<li>For GET, filter the results by clinician_id if not admin.</li>
<li>For PUT, check if the appointment belongs to the authenticated clinician before allowing the update:</li>
</ul>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$stmt = $pdo-&gt;prepare(&quot;SELECT clinician_id FROM appointments WHERE id = :id&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$stmt-&gt;execute([&#x27;id&#x27; =&gt; $appointmentId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$appt = $stmt-&gt;fetch();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($currentUserRole !== &#x27;admin&#x27; &amp;&amp; $appt[&#x27;clinician_id&#x27;] !== $currentUserId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendJson([&#x27;error&#x27; =&gt; &#x27;Forbidden: You can only update your own appointments&#x27;], 403);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ol start="4">
<li>Return appropriate responses</li>
</ol>
<ul>
<li>403 Forbidden if the user violates a policy.</li>
<li>200 OK / 201 Created for valid actions.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-3">Testing:<a href="#testing-3" class="hash-link" aria-label="Direct link to Testing:" title="Direct link to Testing:" translate="no">​</a></h4>
<p>Use Postman to verify policy behavior:</p>
<table><thead><tr><th><strong>User</strong></th><th><strong>Expected Behavior</strong></th></tr></thead><tbody><tr><td><strong>Admin</strong></td><td>Can get, create, update, delete any appointment.</td></tr><tr><td><strong>Clinician</strong></td><td>Can only view and update appointments assigned to them.</td></tr><tr><td><strong>Unauthorized User</strong></td><td>Gets <strong>401 Unauthorized</strong>.</td></tr><tr><td><strong>Other Roles (if any)</strong></td><td>Gets <strong>403 Forbidden</strong>.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mini-project--simple-rbac-dashboard-final-instructions">Mini Project — Simple RBAC Dashboard (Final Instructions)<a href="#mini-project--simple-rbac-dashboard-final-instructions" class="hash-link" aria-label="Direct link to Mini Project — Simple RBAC Dashboard (Final Instructions)" title="Direct link to Mini Project — Simple RBAC Dashboard (Final Instructions)" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="objective-">Objective :<a href="#objective-" class="hash-link" aria-label="Direct link to Objective :" title="Direct link to Objective :" translate="no">​</a></h3>
<p>Build a small web platform (dashboard) that demonstrates authentication, role/permission/group management, and a frontend test-suite for API endpoints. The UI uses AJAX (jQuery) to call demo API endpoints and displays responses in a Swagger-like fashion.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-you-must-do-concise">What you must do (concise)<a href="#what-you-must-do-concise" class="hash-link" aria-label="Direct link to What you must do (concise)" title="Direct link to What you must do (concise)" translate="no">​</a></h3>
<ol>
<li>
<p>Create the dashboard with a side menu and the following pages (5 pages total):</p>
<ul>
<li>Page 1 — API Tester: Seven demo API endpoints. Each endpoint must be callable via AJAX (jQuery). Each endpoint should be able to return three canonical responses:<!-- -->
<ul>
<li>200 OK (success message)</li>
<li>401 Unauthorized (not logged in / invalid token)</li>
</ul>
</li>
<li>403 Forbidden (authenticated but insufficient permission)</li>
<li>Each endpoint is associated with a required role (e.g., admin, clinician, nurse, etc.). On the page show each endpoint with a short description, a button to call it, and a small area below that displays the JSON response and HTTP status (styled like Swagger responses).</li>
<li>Page 2 — Roles: A table listing roles (id, name, description).</li>
<li>Page 3 — Permissions: A table listing permissions (id, name, description).</li>
<li>Page 4 — Groups: A page where groups are listed and each group can be assigned a set of permissions (group → permissions). Explain that groups can be assigned to users as a convenience.</li>
<li>Page 5 — Users: A list of users. Clicking a user opens an edit view where you can toggle (switch buttons) that user’s assigned roles, permissions, and groups. Changes are saved via AJAX.</li>
</ul>
</li>
<li>
<p>API behavior (backend): Implement minimal endpoints needed for the dashboard (authentication + endpoints that return the demo responses). For the demo endpoints on Page 1: each endpoint must simulate/return the three statuses (200 / 401 / 403) depending on the request context (e.g., missing token → 401, token present but wrong role → 403, token + role OK → 200). The UI should be able to trigger each scenario naturally (by sending/omitting a token or using tokens for different role accounts).</p>
</li>
<li>
<p>Frontend requirements:</p>
<ul>
<li>Use jQuery AJAX to call the APIs and show results.</li>
<li>For each demo endpoint show: endpoint name, required role, a “Call” button, result JSON area, and HTTP status (200/401/403) with clear styling.</li>
<li>The display should be compact and user-friendly (Swagger-like response area under each endpoint).</li>
<li>Use toggles/switches on the Users edit page for assigning roles/permissions/groups.</li>
</ul>
</li>
<li>
<p>UX notes: Keep the UI simple and clear — no need for fancy styling. The important part is functionality: buttons that call APIs and visible responses, and a straightforward CRUD interface for roles/permissions/groups/users.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-what-to-include-in-your-submission">Testing (what to include in your submission)<a href="#testing-what-to-include-in-your-submission" class="hash-link" aria-label="Direct link to Testing (what to include in your submission)" title="Direct link to Testing (what to include in your submission)" translate="no">​</a></h3>
<ul>
<li>Demonstrate the three response scenarios for each of the 7 endpoints (200 / 401 / 403). Capture screenshots showing:</li>
<li>Endpoint called successfully (200).</li>
<li>Endpoint returning 401 (no token).</li>
<li>Endpoint returning 403 (token but insufficient role).</li>
<li>Show screenshots of: Roles page, Permissions page, Groups page (with group → permission assignment), Users page and a user-edit view with switches for role/permission/group.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="submission-single-pdf-only">Submission (single PDF only)<a href="#submission-single-pdf-only" class="hash-link" aria-label="Direct link to Submission (single PDF only)" title="Direct link to Submission (single PDF only)" translate="no">​</a></h3>
<p>Create <strong>one</strong> PDF file and submit it via the Google Form link below (demo — replace later):<br>
<strong><a href="https://docs.google.com/forms/d/e/1FAIpQLSfy5WQdFYPU28b84C4wR7wW4SyCi_1S6q9KRgrHi1Sj3vLQwA/viewform?usp=header" target="_blank" rel="noopener noreferrer">https://docs.google.com/forms/d/e/1FAIpQLSfy5WQdFYPU28b84C4wR7wW4SyCi_1S6q9KRgrHi1Sj3vLQwA/viewform?usp=header</a></strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="demo">Demo<a href="#demo" class="hash-link" aria-label="Direct link to Demo" title="Direct link to Demo" translate="no">​</a></h3>
<p><img decoding="async" loading="lazy" alt="mini-project-demo.gif" src="/owasp-top-10-labs/assets/images/mini-project-demo-760e49b4eea34cfc6cd0fadd253f719f.gif" width="2560" height="1320" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img_8.png" src="/owasp-top-10-labs/assets/images/img_8-d988c521fe5a4437a566743f421e6be4.png" width="2559" height="1408" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mehdiaitsaid/owasp-top-10-labs/blob/master/labs/broken-access-control.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/owasp-top-10-labs/labs/injection/xss"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">XSS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/owasp-top-10-labs/labs/cryptographic-failures"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cryptographic Failures</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#what-is-broken-access-control" class="table-of-contents__link toc-highlight">What is Broken Access Control?</a></li><li><a href="#root-causes" class="table-of-contents__link toc-highlight">Root causes</a></li><li><a href="#how-attackers-exploit-it" class="table-of-contents__link toc-highlight">How attackers exploit it</a></li><li><a href="#typical-impacts" class="table-of-contents__link toc-highlight">Typical impacts</a></li><li><a href="#real-world-scenarios" class="table-of-contents__link toc-highlight">Real-world scenarios</a></li></ul></li><li><a href="#mitigating-broken-access-control--acls-roles-permissions-policies" class="table-of-contents__link toc-highlight">Mitigating Broken Access Control — ACLs (Roles, Permissions, Policies)</a><ul><li><a href="#1--authentication-vs-authorization-before-acls" class="table-of-contents__link toc-highlight">1- Authentication vs Authorization (Before ACLs)</a></li><li><a href="#2--high-level-principles-always-follow" class="table-of-contents__link toc-highlight">2- High-level principles (always follow)</a></li><li><a href="#3--acl-concepts-explained-roles-permissions-policies" class="table-of-contents__link toc-highlight">3 — ACL concepts explained (roles, permissions, policies)</a></li><li><a href="#4--recommended-data-model-sql-ish" class="table-of-contents__link toc-highlight">4 — Recommended data model (SQL-ish)</a></li><li><a href="#5--permission-naming-conventions" class="table-of-contents__link toc-highlight">5 — Permission naming conventions</a></li><li><a href="#6--authorization-evaluation-flow-recommended" class="table-of-contents__link toc-highlight">6 — Authorization evaluation flow (recommended)</a></li></ul></li><li><a href="#lab" class="table-of-contents__link toc-highlight">Lab</a><ul><li><a href="#introduction-1" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#lab-objective" class="table-of-contents__link toc-highlight">Lab Objective</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#phase-1--implementing-the-appointments-rest-api" class="table-of-contents__link toc-highlight">Phase 1 — Implementing the Appointments REST API</a></li><li><a href="#phase-2--implementing-user-authentication-and-the-me-endpoint" class="table-of-contents__link toc-highlight">Phase 2 — Implementing User Authentication and the /me Endpoint</a></li><li><a href="#step-1--login-api" class="table-of-contents__link toc-highlight">Step 1 — Login API</a></li><li><a href="#phase-3--adding-authentication-to-appointments-api" class="table-of-contents__link toc-highlight">Phase 3 — Adding Authentication to Appointments API</a></li><li><a href="#phase-4--role-based-access-control-admin-only-for-appointments-api" class="table-of-contents__link toc-highlight">Phase 4 — Role-Based Access Control (Admin Only) for Appointments API</a></li><li><a href="#phase-5--permission-based-access-control-per-endpoint" class="table-of-contents__link toc-highlight">Phase 5 — Permission-Based Access Control per Endpoint</a></li><li><a href="#phase-5--policy-based-access-control-pbac" class="table-of-contents__link toc-highlight">Phase 5 — Policy-Based Access Control (PBAC)</a></li></ul></li><li><a href="#mini-project--simple-rbac-dashboard-final-instructions" class="table-of-contents__link toc-highlight">Mini Project — Simple RBAC Dashboard (Final Instructions)</a><ul><li><a href="#objective-" class="table-of-contents__link toc-highlight">Objective :</a></li><li><a href="#what-you-must-do-concise" class="table-of-contents__link toc-highlight">What you must do (concise)</a></li><li><a href="#testing-what-to-include-in-your-submission" class="table-of-contents__link toc-highlight">Testing (what to include in your submission)</a></li><li><a href="#submission-single-pdf-only" class="table-of-contents__link toc-highlight">Submission (single PDF only)</a></li><li><a href="#demo" class="table-of-contents__link toc-highlight">Demo</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Labs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/owasp-top-10-labs/labs/intro">Hands-On Labs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mehdi-aitsaid/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.instagram.com/mehdi.aitsaid/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/mehdiaitsaid" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.ump.ma/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Université Mohammed I</a></li><li class="footer__item"><a href="https://estn.ump.ma/" target="_blank" rel="noopener noreferrer" class="footer__link-item">EST Nador<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Pr. AIT SAID Mehdi.</div></div></div></footer></div>
</body>
</html>